# 5. Forecast

For each of our country forecasts, we have decided to use the model with the lowest RMSE as shown in the previous section. This is because we want our models to be as "accurate" as possible, in away that we minimize the error/distance between our forecast values and the actual values. In summary, we used SARIMA for Italy and all countries together, and ETS for all other countries.

#### Side note: 

Below, for each country, you can see a residual analysis for the every selected model, a graph of the forecast, and finally the forecast table. 

The outcome of the residual analysis is to confirm that the model has done a good job fitting the data, and more specifically, here's what we obtained from it: 

A good model fit has the following characteristics in terms of its residuals: 
- The residuals are distributed symmetrically, in a shape that resembles a Normal distribution. 
- Low ACF (autocorrelation) in the first few lags. 
- No Heteroskedasticity: the variance of the residuals is constant. 
- There is no trend in the residuals. 

In essence, what this all means, is that the residuals are white noise. Let's now look at the results for each country, and make some more specific comments: 

## 5.1 Germany{.tabset}
We fit Germany electricity demand data using the ETS model.
```{r, warning=FALSE}
# Modelling ARIMA automatically
ets_germany <- data_elec %>%
  select(Germany) %>%
  model(ets = ETS(Germany))

# Forecasting using the models
forecast_ets_germany <- ets_germany %>% forecast(h = 13) %>% hilo(90)
```

### **Checking Residuals**
The output below suggests that the ETS model did a decent job in capturing all the dynamics in data, as the residuals seem to be white noise.

However, it seems like this model for Germany is not fitting well. More specifically, we see that there is more variation in the distribution of the residuals of Germany's model. Nevertheless, the distribution of the errors is symmetric, which is good. Furthermore, we notice the peaks in some of the lagged periods of the ACF graph, indicating the presence of autocorrelation between the time periods and the previous time periods, which is not great in terms of how well the model fits the data. 
```{r}
ets_germany %>% gg_tsresiduals(lag_max = 36) + labs(title = "ETS Germany residuals analysis")
```

### **Graphing the forecast**
For better visualization, we plot our forecast results starting from 2015.
```{r}
ets_germany %>% forecast(h = 13) %>% autoplot(Germany_since_2015) +
  labs(title = "ETS Forecast for Germany")

#Extracting the forecasted values
forecast_table_germany_e <- data.frame(Model = c("ETS"),
                              Forecast_Values = c(forecast_ets_germany))



forecast_table_germany_e <- forecast_table_germany_e %>% select(Forecast_Values.Date,Forecast_Values..mean, Forecast_Values.90.) 
forecast_table_germany_e$Country <- "Germany"

colnames(forecast_table_germany_e)[1] <- "Month"
colnames(forecast_table_germany_e)[2] <- "PF"
colnames(forecast_table_germany_e)[3] <- "CI"


```
### **Forecast Table**
The resulting forecast table for Germany is shown below. 
```{r}
forecast_table_germany_e
```

## 5.2 Italy{.tabset}
We fit Italy electricity demand data using the ARIMA model.
```{r}
# Modelling ETS automatically
arima_italy <- data_elec %>%
  select(Italy) %>%
  model(ARIMA(Italy))

# Forecasting using the models
forecast_arima_italy <- arima_italy %>% forecast(h = 13) %>% hilo(90)
```

### **Checking Residuals**
The output below suggests that the ARIMA model did well in capturing all the dynamics in data, as the residuals seem to be white noise.
```{r}
arima_italy %>% gg_tsresiduals(lag_max = 36) + labs(title = "ARIMA Italy residuals analysis")
```

### **Graphing the forecast**
For better visualization, we plot our forecast results starting from 2018.
```{r}
arima_italy %>% forecast(h = 13) %>% autoplot(Italy_since_2018) +
  labs(title = "ARIMA Forecast for Italy")

#Extracting the forecasted values
forecast_table_italy_a <- data.frame(Model = c("ARIMA"),
                          Forecast_Values = c(forecast_arima_italy))

forecast_table_italy_a <- forecast_table_italy_a %>% select(Forecast_Values.Date,Forecast_Values..mean, Forecast_Values.90.)
forecast_table_italy_a$Country <- "Italy"

colnames(forecast_table_italy_a)[1] <- "Month"
colnames(forecast_table_italy_a)[2] <- "PF"
colnames(forecast_table_italy_a)[3] <- "CI"
```

### **Forecast Table**
The resulting forecast table for Italy is shown below. 
```{r}
forecast_table_italy_a
```

## 5.3 Austria{.tabset}
We fit Austria electricity demand data using the ETS model.
```{r}
# Modelling ETS automatically
ets_austria <- data_elec %>%
  select(Austria) %>%
  model(ETS(Austria))

# Forecasting using the models
forecast_ets_austria <- ets_austria %>% forecast(h = 13) %>% hilo(90)
```

### **Checking Residuals**
The output below suggests that the ETS model did well in capturing all the dynamics in data, as the residuals seem to be white noise.
```{r}
ets_austria %>% gg_tsresiduals(lag_max = 36) + labs(title = "ETS Austria residuals analysis")
```

### **Graphing the forecast**
For better visualization, we plot our forecast results starting from 2018.
```{r}
ets_austria %>% forecast(h = 13) %>% autoplot(Austria_since_2018) +
  labs(title = "ETS Forecast for Austria")

#Extracting the forecasted values
forecast_table_austria_e <- data.frame(Model = c("ETS"),
                          Forecast_Values = c(forecast_ets_austria))

forecast_table_austria_e <- forecast_table_austria_e %>% select(Forecast_Values.Date,Forecast_Values..mean, Forecast_Values.90.)
forecast_table_austria_e$Country <- "Austria"

colnames(forecast_table_austria_e)[1] <- "Month"
colnames(forecast_table_austria_e)[2] <- "PF"
colnames(forecast_table_austria_e)[3] <- "CI"
```

### **Forecast Table**
The resulting forecast table for Austria is shown below. 
```{r}
forecast_table_austria_e

```

## 5.4 France{.tabset}
We fit France electricity demand data using the ETS model.
```{r}
# Modelling ETS automatically
ets_france <- data_elec %>%
  select(France) %>%
  model(ETS(France))

# Forecasting using the models
forecast_ets_france <- ets_france %>% forecast(h = 13) %>% hilo(90)
```

### **Checking Residuals**
The output below suggests that the ETS model did a decent job in capturing all the dynamics in data, as the residuals seem to be white noise.

However, it seems like this model for France is not fitting as well as the other models for the previous countries. More specifically, we see that there is more variation in the distribution of the residuals of France's model compared to other countries. Nevertheless, the distribution of the errors is symmetric, which is good. Furthermore, we notice a peak in the first lagged period of the ACF graph, indicating the presence of autocorrelation between a time period and the previous time period, which is not great in terms of how well the model fits the data. 

```{r}
ets_france %>% gg_tsresiduals(lag_max = 36) + labs(title = "ETS France residuals analysis")
```

### **Graphing the forecast**
For better visualization, we plot our forecast results starting from 2015.
```{r}
ets_france %>% forecast(h = 13) %>% autoplot(France_since_2015) +
  labs(title = "ETS Forecast for France")

#Extracting the forecasted values
forecast_table_france_e <- data.frame(Model = c("ETS"),
                          Forecast_Values = c(forecast_ets_france))

forecast_table_france_e <- forecast_table_france_e %>% select(Forecast_Values.Date,Forecast_Values..mean, Forecast_Values.90.)
forecast_table_france_e$Country <- "France"

colnames(forecast_table_france_e)[1] <- "Month"
colnames(forecast_table_france_e)[2] <- "PF"
colnames(forecast_table_france_e)[3] <- "CI"

```

### **Forecast Table**
The resulting forecast table for France is shown below. 
```{r}
forecast_table_france_e

```

## 5.5 Lichtenstein{.tabset}
We fit Total electricity demand data using the ETS model.
### ETS
```{r}
# Modelling ETS automatically
ets_Licht <- data_elec %>%
  select(Lichtenstein) %>%
  model(ETS(Lichtenstein))
# Getting the Accuracy scores for models
report(ets_Licht)

# Forecasting using the models
forecast_ets_Licht <- ets_Licht %>% forecast(h = 13) %>% hilo(90)
forecast_ets_Licht$.mean <- ifelse(forecast_ets_Licht$.mean < 0, 0, forecast_ets_Licht$.mean)
```

### **Checking Residuals**
```{r}
#Checking the residuals before forecasting
ets_Licht %>% gg_tsresiduals(lag_max = 36) + labs(title = "ETS Lichtenstein residuals analysis")
```

### **Graphing the forecast**

```{r}
# Graphing the forecast
ets_Licht %>% forecast(h = 13) %>% autoplot(Lichtenstein_after_2008) +
  labs(title = "ETS Forecast for Lichtenstein")

#Extracting the forecasted values
forecast_table_Lichtenstein_ets <- data.frame(Model = c("ETS"),
                              Forecast_Values = c(forecast_ets_Licht))

forecast_table_Lichtenstein_ets <- forecast_table_Lichtenstein_ets %>% select(Forecast_Values.Date,Forecast_Values..mean, Forecast_Values.90.)
forecast_table_Lichtenstein_ets$Country <- "Lichtenstein"

colnames(forecast_table_Lichtenstein_ets)[1] <- "Month"
colnames(forecast_table_Lichtenstein_ets)[2] <- "PF"
colnames(forecast_table_Lichtenstein_ets)[3] <- "CI"
```
### **Forecast Table**
The resulting forecast table for Lichtenstein is shown below. 
```{r}
forecast_table_Lichtenstein_ets
```

## 5.6 Total{.tabset}
We fit Total electricity demand data using the ARIMA model.
```{r}
# Modelling ETS automatically
arima_total <- data_elec %>%
  select(Total) %>%
  model(ARIMA(Total))

# Forecasting using the models
forecast_arima_total <- arima_total %>% forecast(h = 13) %>% hilo(90)
```

### **Checking Residuals**
The output below suggests that the ARIMA model did well in capturing all the dynamics in data, as the residuals seem to be white noise.
```{r}
arima_total %>% gg_tsresiduals(lag_max = 36) + labs(title = "ARIMA residuals analysis for all countries")

```

### **Graphing the forecast**
For better visualization, we plot our forecast results starting from 2015.
```{r}
arima_total %>% forecast(h = 13) %>% autoplot(Total_since_2015) +
  labs(title = "ARIMA Forecast for All Countries")

#Extracting the forecasted values
forecast_table_total_a<- data.frame(Model = c("ARIMA"),
                          Forecast_Values = c(forecast_arima_total))

forecast_table_total_a <- forecast_table_total_a %>% select(Forecast_Values.Date,Forecast_Values..mean, Forecast_Values.90.)
forecast_table_total_a$Country <- "Total"

colnames(forecast_table_total_a)[1] <- "Month"
colnames(forecast_table_total_a)[2] <- "PF"
colnames(forecast_table_total_a)[3] <- "CI"

```

### **Forecast Table**
The resulting forecast table for Total is shown below. 
```{r}
forecast_table_total_a
```


## Combining all forecasts into one table: 
Below is the final table containing `Month,` point forecast `PF,` 80% lower and upper confidence levels (see Appendix 3.) interval forecast `CI,` and `Country.`  
```{r}

final_fc <- bind_rows(forecast_table_germany_e, forecast_table_italy_a, forecast_table_france_e, forecast_table_austria_e,forecast_table_Lichtenstein_ets, forecast_table_total_a)

final_fc

```

# 6. Challenges and Further Analysis

Some of Germany's and Austria's lower values remain negative with 90% confidence intervals. It may indicate that the forecasting model or method used may not adequately capture the underlying dynamics of electricity demand. Even though the models were chosen based on the accuracy analysis we conducted before. Further investigation and model testing is required.
