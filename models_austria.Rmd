
# Austria

Visualizing Austria again -> looks like we shouldn't use the whole data for this forecast, as there is a significant change at around 2016-2018

```{r}
data_elec %>% autoplot(Austria) + 
  ggtitle("Exports from Switzerland to Austria") +
  ylab("GWt") + xlab("Month")
```

- Should probably do piecewise for austria since there's a big change in February 2018

```{r}
#Investigating Austria closely since 2018, because it seems like something changed -> perhaps should use Piecewise!!!
Austria_since_2015 <- data_elec %>% select(Date,Austria) %>% filter(Date >= as.Date("2015-01-01"))
Austria_since_2018 <- data_elec %>% select(Date,Austria) %>% filter(Date >= as.Date("2018-02-01"))
autoplot(Austria_since_2015)
autoplot(Austria_since_2018)
```

```{r}

#Split the data
training_au <- data_elec %>% select(Date, Austria) %>%  filter(Date < as.Date("2016-01-01"))
test_au <- data_elec %>% select(Date, Austria) %>% filter(Date >= as.Date("2016-01-01"))

# Fit ARIMA model and generate forecasts
data_fit_au_a <- training_au %>%
  model(ARIMA(Austria, stepwise = FALSE))
forecasts_au_a <- data_fit_au_a %>%
  forecast(h = 60)

# Fit ETS model and generate forecasts
data_fit_au_e <- training_au %>%
  model(ETS(Austria))
forecasts_au_e <- data_fit_au_e %>%
  forecast(h = 60)

# Fit seasonal naive model and generate forecasts
data_fit_au_n <- training_au %>%
  model(SNAIVE(Austria))
forecasts_au_n <- data_fit_au_n %>%
  forecast(h = 60)

# Combine forecasts into a single data frame
all_forecasts_au <- bind_rows(
  data.frame(Date = forecasts_au_a$Date, Method = "ARIMA", Forecast = forecasts_au_a$.mean),
  data.frame(Date = forecasts_au_e$Date, Method = "ETS", Forecast = forecasts_au_e$.mean),
  data.frame(Date = forecasts_au_n$Date, Method = "SNAIVE", Forecast = forecasts_au_n$.mean))


# Plot all three sets of forecasts together
data_elec %>% autoplot(Austria) +
  geom_line(data = all_forecasts_au, aes(x = Date, y = Forecast, color = Method)) +
  labs(title = "Electricity Demand in Austria")

```
According to the accuracy table below, RMSE, MAE, and other indicators, ETS has the lowest values on the test data. However, ARIMA has lower values of AIC=1839.24, AICc=1840.03, and BIC=1865.3 than the ETS model. 
```{r}
#Accuracy
austria_accuracy_a <-data_fit_au_a %>%
  refit(test_au) %>%
  accuracy()

austria_accuracy_e <-data_fit_au_e %>%
  refit(test_au) %>%
  accuracy()

austria_accuracy_n <-data_fit_au_n %>%
  refit(test_au) %>%
  accuracy()

austria_accuracy_table <- rbind(
  data.frame(austria_accuracy_a),
  data.frame(austria_accuracy_e),
  data.frame(austria_accuracy_n))



#AIC
report(data_fit_au_a)
austria_accuracy_table
report(data_fit_au_e)

```
### Residuals
The output below also suggests that the ARIMA model did well in capturing all the dynamics in data, as the residuals seem to be white noise.
```{r}
gg_tsresiduals(data_fit_au_a) + labs(title = "ARIMA Austria residuals analysis")

gg_tsresiduals(data_fit_au_e) + labs(title = "ETS Austria residuals analysis")

gg_tsresiduals(data_fit_au_n) + labs(title = "SNAIVE Austria residuals analysis")
```
## S-ARIMA

```{r}

#Modelling ARIMA automatically
arima_austria <- data_elec %>%
  select(Austria) %>%
  model(ARIMA(Austria, stepwise = FALSE)) #By default, stepwise is set to TRUE, which means the function performs a stepwise search to identify the best model by iteratively considering different model orders and selecting the model with the lowest AIC value.
#However, this approach also has some potential drawbacks. The stepwise algorithm might not search through all possible models, and therefore might not find the best-fitting model. Additionally, using stepwise selection might lead to overfitting, especially if the algorithm is used iteratively to search for the "best" model among many different time series.

#Getting the Accuracy scores for models
report(arima_austria) #ARIMA(0,1,3)(2,0,0)

#Forecasting using the models
forecast_arima_austria <- arima_austria %>% forecast(h = 13)

#Graphing the forecast
arima_austria %>% forecast(h = 13) %>% autoplot(Austria_since_2018)+
  labs(title = "SARIMA Forecast for Austria")

#Extracting the forecasted values
forecast_table_austria_arima <- data.frame(Model = c("SARIMA"),
                              Forecast_Values = c(forecast_arima_austria))

forecast_table_austria_arima <- forecast_table_austria_arima %>% select(Forecast_Values..mean)

colnames(forecast_table_austria_arima)[1] <- "Austria_Arima"

```

## S-Naive Model

```{r}
# Modelling SNaive automatically
#snaive_austria <- data_elec %>%
#  select(Austria) %>%
#  model(snaive = SNAIVE(Austria, h = 13))
#
## Getting the accuracy scores for models
#report(snaive_austria)
#
## Forecasting using the model
#forecast_snaive_austria <- snaive_austria %>% forecast(h = 13)
#
## Graphing the forecast
#snaive_austria %>% forecast(h = 13) %>% autoplot(Austria_since_2015) +
#  labs(title = "Seasonal Naive Forecast for Austria")
#
## Extracting the forecasted values
#forecast_table_austria <- data.frame(Model = c("SNaive"),
#                                    Forecast_Values = c(forecast_snaive_austria))
#
#forecast_table_austria <- forecast_table_austria %>% select(Forecast_Values..mean)
#
#colnames(forecast_table_austria)[1] <- "Austria_snaive"
#
#forecast_table_italy
```

## ETS Model 

```{r}

#Modelling ets automatically
#ets_austria <- data_elec %>%
#  select(Austria) %>%
#  model(ETS(Austria))
#
##Getting the Accuracy scores for models
#report(ets_austria)
#
##Forecasting using the models
#forecast_ets_austria <- ets_austria %>% forecast(h = 13)
#
##Graphing the forecast
#ets_austria %>% forecast(h = 13) %>% autoplot(Austria_since_2015)+
#  labs(title = "ETS ANA Forecast for Austria")
#
##Extracting the forecasted values
#
#forecast_table_austria <- data.frame(Model = c("ETS (ANA)"),
#                              Forecast_Values = c(forecast_ets_austria))
#
#forecast_table_austria <- forecast_table_austria %>% select(Forecast_Values..mean)
#
#colnames(forecast_table_austria)[1] <- "Austria_ets_ANA"
#
#
#components(ets_austria) %>% autoplot()